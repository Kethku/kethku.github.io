<html>
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-139157194-1"></script>
    <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());

     gtag('config', 'UA-139157194-1');
    </script>

    <meta name="viewport" content="width=device-width, user-scalable=false">
    <!-- Disable dark reader. Its already dark! --->
    <meta name="darkreader-lock">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" href="https://kaylees.dev/style.css">
    <link rel="stylesheet" href="https://unpkg.com/basic-css-typography-reset@1.0.0/typography.min.css">
    
    <title>Kaylee's Dev 

Maple
</title>
  </head>
  <body>
    <header>
      <h3>



<a href="https:&#x2F;&#x2F;kaylees.dev&#x2F;">The Trees</a>


<a href="https:&#x2F;&#x2F;kaylees.dev&#x2F;trio&#x2F;">The Fork</a>


<a href="https:&#x2F;&#x2F;kaylees.dev&#x2F;trio&#x2F;maple&#x2F;">Maple</a>

Day19 - Two Columns And Refactoring
</h3>
    </header>
    <div id="content">
    
<article>
  <summary>
    
    <h2>
      Refactored the Room Endpoint Plus Some CSS
    </h2>
    
    
    <p>
    
      2023-04-28
    
    
    </p>
    
  </summary>
  <p>Quick post today as its very late and my day was pretty
chaotic. I worked on the site style a bit more in
preparation for the dynamic portion of the site and
refactored the endpoint I wrote yesterday for the same
reason.</p>
<h2 id="two-columns">Two Columns</h2>
<p>The new site structure has the main content to the left with
a dynamic column that is sticky on the right side. When on
mobile the dynamic column is hidden away because its not
strictly required. To achieve these three goals, I
refactored the site style to use a css grid layout and a
media query to add the extra css when the viewer is big
enough.</p>
<pre data-lang="sass" class="language-sass z-code"><code class="language-sass" data-lang="sass"><span class="z-source z-sass"><span class="z-comment z-line z-double-slash z-sass"><span class="z-punctuation z-definition z-comment z-css">//</span> If screen is small, don&#39;t show the sidebar
</span><span class="z-comment z-line z-double-slash z-sass"><span class="z-punctuation z-definition z-comment z-css">//</span> just have a single column of content centered on the screen
</span><span class="z-meta z-selector z-css"><span class="z-entity z-name z-tag z-css">body</span>
</span>    <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">background-color</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-variable z-other z-sass"><span class="z-punctuation z-definition z-variable z-sass">$</span>background</span></span><span class="z-meta z-property-value z-css">
</span>    <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">display</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-support z-constant z-property-value z-css">grid</span></span><span class="z-meta z-property-value z-css">
</span>    <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">justify-content</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-support z-constant z-property-value z-css">center</span></span><span class="z-meta z-property-value z-css">
</span>    <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">grid-template-columns</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-meta z-function-call z-css"><span class="z-support z-function z-grid z-css">minmax</span><span class="z-meta z-group z-css"><span class="z-punctuation z-definition z-group z-begin z-css">(</span><span class="z-constant z-numeric z-integer z-decimal z-css">10<span class="z-keyword z-other z-unit z-css">px</span></span><span class="z-punctuation z-separator z-sequence z-css">,</span> <span class="z-variable z-other z-sass"><span class="z-punctuation z-definition z-variable z-sass">$</span>contentWidth</span></span><span class="z-meta z-group z-css"><span class="z-punctuation z-definition z-group z-end z-css">)</span></span></span></span><span class="z-meta z-property-value z-css">
</span>    <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">grid-template-rows</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-support z-constant z-property-value z-css">auto</span> <span class="z-support z-constant z-property-value z-css">auto</span> <span class="z-support z-constant z-property-value z-css">auto</span> <span class="z-constant z-numeric z-integer z-decimal z-css">1<span class="z-keyword z-other z-unit z-css">fr</span></span></span><span class="z-meta z-property-value z-css">
</span>    <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">grid-template-areas</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-string z-quoted z-double z-css"><span class="z-punctuation z-definition z-string z-begin z-css">&quot;</span>header<span class="z-punctuation z-definition z-string z-end z-css">&quot;</span></span> <span class="z-string z-quoted z-double z-css"><span class="z-punctuation z-definition z-string z-begin z-css">&quot;</span>main<span class="z-punctuation z-definition z-string z-end z-css">&quot;</span></span> <span class="z-string z-quoted z-double z-css"><span class="z-punctuation z-definition z-string z-begin z-css">&quot;</span>footer<span class="z-punctuation z-definition z-string z-end z-css">&quot;</span></span> <span class="z-string z-quoted z-double z-css"><span class="z-punctuation z-definition z-string z-begin z-css">&quot;</span>.<span class="z-punctuation z-definition z-string z-end z-css">&quot;</span></span></span><span class="z-meta z-property-value z-css">
</span>
<span class="z-meta z-selector z-css"><span class="z-entity z-other z-attribute-name z-id z-css"><span class="z-punctuation z-definition z-entity z-css">#</span></span><span class="z-entity z-other z-attribute-name z-id z-css">sidebar</span>
</span>    <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">display</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-support z-constant z-property-value z-css">none</span></span><span class="z-meta z-property-value z-css">
</span>
<span class="z-meta z-at-rule z-media z-css"><span class="z-keyword z-control z-at-rule z-media z-css"><span class="z-punctuation z-definition z-keyword z-css">@</span>media</span> <span class="z-punctuation z-definition z-group z-begin z-css">(</span><span class="z-support z-type z-property-name z-media z-css">min-width</span><span class="z-punctuation z-separator z-key-value z-css">:</span> <span class="z-variable z-other z-sass"><span class="z-punctuation z-definition z-variable z-sass">$</span>contentWidth</span><span class="z-punctuation z-definition z-group z-end z-css">)</span></span>
    <span class="z-comment z-line z-double-slash z-sass"><span class="z-punctuation z-definition z-comment z-css">//</span> If the screen is bigger than 11 inches show the sidebar
</span>    <span class="z-comment z-line z-double-slash z-sass"><span class="z-punctuation z-definition z-comment z-css">//</span> fit-content is used so that if the sidebar doesn&#39;t exist,
</span>    <span class="z-comment z-line z-double-slash z-sass"><span class="z-punctuation z-definition z-comment z-css">//</span> the main content is still centered on the screen
</span><span class="z-meta z-selector z-css">    <span class="z-entity z-name z-tag z-css">body</span>
</span>        <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">display</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-support z-constant z-property-value z-css">grid</span></span><span class="z-meta z-property-value z-css">
</span>        <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">grid-template-columns</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-constant z-numeric z-integer z-decimal z-css">1<span class="z-keyword z-other z-unit z-css">fr</span></span> <span class="z-variable z-other z-sass"><span class="z-punctuation z-definition z-variable z-sass">$</span>contentWidth</span> <span class="z-constant z-numeric z-integer z-decimal z-css">10<span class="z-keyword z-other z-unit z-css">px</span></span> <span class="z-meta z-function-call z-css"><span class="z-support z-function z-sass">fit-content</span><span class="z-meta z-group z-css"><span class="z-meta z-function-call z-arguments z-css"><span class="z-punctuation z-definition z-group z-begin z-css">(</span><span class="z-constant z-numeric z-integer z-decimal z-css">3<span class="z-keyword z-other z-unit z-css">in</span></span></span></span><span class="z-meta z-group z-css"><span class="z-punctuation z-definition z-group z-end z-css">)</span></span></span> <span class="z-constant z-numeric z-integer z-decimal z-css">1<span class="z-keyword z-other z-unit z-css">fr</span></span></span><span class="z-meta z-property-value z-css">
</span>        <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">grid-template-rows</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-support z-constant z-property-value z-css">auto</span> <span class="z-support z-constant z-property-value z-css">auto</span> <span class="z-support z-constant z-property-value z-css">auto</span> <span class="z-constant z-numeric z-integer z-decimal z-css">1<span class="z-keyword z-other z-unit z-css">fr</span></span></span><span class="z-meta z-property-value z-css">
</span>        <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">grid-template-areas</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-string z-quoted z-double z-css"><span class="z-punctuation z-definition z-string z-begin z-css">&quot;</span>. header header header . <span class="z-punctuation z-definition z-string z-end z-css">&quot;</span></span> <span class="z-string z-quoted z-double z-css"><span class="z-punctuation z-definition z-string z-begin z-css">&quot;</span>. main . sidebar .<span class="z-punctuation z-definition z-string z-end z-css">&quot;</span></span> <span class="z-string z-quoted z-double z-css"><span class="z-punctuation z-definition z-string z-begin z-css">&quot;</span>. footer footer footer .<span class="z-punctuation z-definition z-string z-end z-css">&quot;</span></span> <span class="z-string z-quoted z-double z-css"><span class="z-punctuation z-definition z-string z-begin z-css">&quot;</span>. . . . .<span class="z-punctuation z-definition z-string z-end z-css">&quot;</span></span></span><span class="z-meta z-property-value z-css">
</span>
<span class="z-meta z-selector z-css">    <span class="z-entity z-other z-attribute-name z-id z-css"><span class="z-punctuation z-definition z-entity z-css">#</span></span><span class="z-entity z-other z-attribute-name z-id z-css">sidebar</span>
</span>        <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">display</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-support z-constant z-property-value z-css">block</span></span><span class="z-meta z-property-value z-css">
</span>        <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">align-self</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-support z-constant z-property-value z-css">start</span></span><span class="z-meta z-property-value z-css">
</span>        <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">grid-area</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-string z-unquoted z-css">sidebar</span></span><span class="z-meta z-property-value z-css">
</span>        <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">top</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-constant z-numeric z-integer z-decimal z-css">0</span></span><span class="z-meta z-property-value z-css">
</span>        <span class="z-meta z-property-name z-css"><span class="z-support z-type z-property-name z-css">position</span></span><span class="z-punctuation z-separator z-key-value z-css">:</span><span class="z-meta z-property-value z-css"> <span class="z-support z-constant z-property-value z-css">sticky</span></span><span class="z-meta z-property-value z-css">
</span></span></code></pre>
<p>The key points are using the @media query with the same body
style just updated to have the extra sidebar column. I used
fit-content(3in) so that if there isn't any text in the
sidebar, that column collapses to zero width giving the main
content more space.</p>
<p><code>top: 0</code> and <code>position: sticky</code> puts the sidebar at the top
of the screen so that the dynamic content is always visible
even when the user has scrolled a bit.</p>
<p>For now these changes aren't really that visible, once the
sidebar gets some actual content in it, the user will be
able to see messages when other visitors arrive and may even
be able to interact with them. Initially I just want live
notifications and intractability with the expectation that
basically nobody will be on the site. But eventually I would
like to handle scaling out to many users.</p>
<h2 id="refactoring">Refactoring</h2>
<p>With the site design out of the way for now, I also worked
on refactoring the room endpoint. Yesterday's code was very
simple but not very extensible or readable. So today I
pulled the Visitor, Room, and World structs out into their
own modules. I moved the mutation functions into the world
struct by creating <code>get_visitor</code> and <code>move_visitor</code> helpers
to wrap up the long function from yesterday into higher
level pieces. The endpoint itself then becomes extremely
simple.</p>
<pre data-lang="rs" class="language-rs z-code"><code class="language-rs" data-lang="rs"><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">get</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>/room/&lt;visitor_id&gt;/&lt;path..&gt;<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
<span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">visit_room</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">visitor_id</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">usize</span>, <span class="z-variable z-parameter z-rust">path</span><span class="z-punctuation z-separator z-rust">:</span> PathBuf, <span class="z-variable z-parameter z-rust">world</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&amp;</span><span class="z-meta z-generic z-rust">State<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>World<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-meta z-generic z-rust">Json<span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span>RoomSnapshot<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-storage z-type z-rust">let</span> visitor <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get_visitor</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>visitor_id</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
    <span class="z-keyword z-operator z-arithmetic z-rust">*</span>visitor<span class="z-punctuation z-accessor z-dot z-rust">.</span>last_seen<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">write</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Instant<span class="z-punctuation z-accessor z-rust">::</span></span>now<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
    <span class="z-storage z-type z-rust">let</span> room <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">move_visitor</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&amp;</span>visitor<span class="z-punctuation z-separator z-rust">,</span> <span class="z-keyword z-operator z-bitwise z-rust">&amp;</span>path</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
    Json<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>room<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">snapshot</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>visitor<span class="z-punctuation z-accessor z-dot z-rust">.</span>id</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>My hope is that as more functionality is created, they can
follow this same pattern of simple operations built up of
basic building blocks.</p>
<p>But for now its very late and I must sleep. Till tomorrow<br />
Kay</p>

  
</article>

    </div>
    <!-- <div id="sidebar"> -->
    <!--   <h2>Dynamic Content</h2> -->
    <!--   <p>Some dynamic details to put in the aside</p> -->
    <!-- </div> -->
    <footer>
      
<div id="page-nav-links">
  <h3>
    
    <a href="https:&#x2F;&#x2F;kaylees.dev&#x2F;trio&#x2F;maple&#x2F;day18-basic-rest-server&#x2F;" id="previous-nav">Previous</a>
    

    
    <a href="https:&#x2F;&#x2F;kaylees.dev&#x2F;trio&#x2F;maple&#x2F;day20-sprites&#x2F;" id="next-nav">Next</a>
    
  </h3>
</div>

    </footer>
  </body>
</html>
